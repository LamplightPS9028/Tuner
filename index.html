<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Tuner</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

	<!-- Simple tuner script -->
	<script src="https://halimb.github.io/simple-tuner/simple-tuner.js"></script>

	<script>

	// Wait for the page to load before initializing the tuner
	window.addEventListener('load', init_tuner, false);

	// Global variables
	let audioContext, analyser, microphone;
	let noteDisplay, frequencyDisplay, tuningDisplay, waveformCanvas, barGraphCanvas;

	// Function to initialize the tuner
	function init_tuner() {
		// Set up the Web Audio API context and the analyser
		audioContext = new (window.AudioContext || window.webkitAudioContext)();
		analyser = audioContext.createAnalyser();
		noteDisplay = document.querySelector('.tuner-data.note');
		frequencyDisplay = document.querySelector('.tuner-data.frequency');
		tuningDisplay = document.querySelector('.tuner-data.tuning');
		waveformCanvas = document.getElementById('waveform');
		barGraphCanvas = document.getElementById('bargraph');

		// Initialize Simple Tuner
		const tuner = new SimpleTuner({
			'canvas': document.getElementById('waveform'), // Attach to your canvas
			'input': 'microphone', // Use microphone input
			'autoStart': true, // Automatically start tuning
			'sensitivity': 100, // Adjust sensitivity for frequency detection
			'minimumFrequency': 30, // Lower limit for frequency range
			'maximumFrequency': 2000 // Upper limit for frequency range
		});

		// Set up tuner callbacks
		tuner.on('note', function(note) {
			// Display note data
			noteDisplay.textContent = note.name;
			frequencyDisplay.textContent = note.frequency + ' Hz';
			tuningDisplay.textContent = note.tuning;
		});

		tuner.on('frequency', function(frequency) {
			// Update frequency display
			frequencyDisplay.textContent = frequency + ' Hz';
		});

		// Handle waveform and bar graph rendering
		function render() {
			tuner.render(); // Render waveform on canvas

			// Request next frame
			requestAnimationFrame(render);
		}

		// Start rendering the tuner display
		render();
	}
	</script>

</head>
<body>

	<div class="tuner tuner-ui-debug">
		<h2>Tuner Settings</h2>
		<table>
			<tbody>
				<tr>
					<td><strong>Base Frequency</strong></td>
					<td class="tuner-data base-frequency">--</td>
				</tr>
				<tr>
					<td><strong>Instrument</strong></td>
					<td class="tuner-data instrument">--</td>
				</tr>
				<tr>
					<td><strong>Tuning</strong></td>
					<td class="tuner-data tuning">--</td>
				</tr>
				<tr>
					<td><strong>Tuning information</strong></td>
					<td class="tuner-data tuning-info">--</td>
				</tr>
			</tbody>
		</table>

		<h2>Frequency Information</h2>
		<table>
			<tbody>
				<tr>
					<td><strong>Frequency (Hz)</strong></td>
					<td class="tuner-data frequency">--</td>
				</tr>
				<tr>
					<td><strong>Note</strong></td>
					<td class="tuner-data note">--</td>
				</tr>
				<tr>
					<td><strong>Tuning</strong></td>
					<td class="tuner-data tuning">--</td>
				</tr>
			</tbody>
		</table>

		<h2>Signal Information</h2>
		<table>
			<tbody>
				<tr>
					<td><strong>Waveform</strong></td>
					<td><canvas id="waveform" width="480" height="160"></canvas></td>
				</tr>
				<tr>
					<td><strong>Bar-Graph</strong></td>
					<td><canvas id="bargraph" width="480" height="160"></canvas></td>
				</tr>
			</tbody>
		</table>

	</div>

</body>
</html>
